RewriteEngine On
RewriteBase /

# 1. Редирект всех .html и /pages/ на чистые URL
RewriteCond %{THE_REQUEST} /pages/([^\s?]+)\.html [NC]
RewriteRule ^ /%1 [R=301,L,NE]

RewriteCond %{THE_REQUEST} \s/(.*)\.html[\s?] [NC]
RewriteRule ^ /%1 [R=301,L,NE]

# 2. Внутренняя подмена URL → файлов из папки pages
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}/pages/%1.html -f
RewriteRule ^([^/]+)/?$ pages/$1.html [L]

# 3. Главная страница и базовые настройки
RewriteCond %{THE_REQUEST} /index\.html [NC]
RewriteRule ^index\.html$ / [R=301,L]

# 4. Безопасность и кэширование
<FilesMatch "\.(env|log|htaccess|htpasswd|ini|bak|sql)$">
  Require all denied
</FilesMatch>

<FilesMatch "offline\.html">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

Options -Indexes
ErrorDocument 400 /pages/400
ErrorDocument 401 /pages/401
ErrorDocument 403 /pages/403
ErrorDocument 404 /pages/404
ErrorDocument 500 /pages/500
ErrorDocument 503 /pages/offline

# 5. Оптимизация производительности
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml application/xhtml+xml image/svg+xml font/woff2
  DeflateCompressionLevel 6
  Header append Vary: Accept-Encoding
</IfModule>

AddDefaultCharset UTF-8